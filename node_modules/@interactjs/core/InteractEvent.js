import extend from '@interactjs/utils/extend';
import getOriginXY from '@interactjs/utils/getOriginXY';
import hypot from '@interactjs/utils/hypot';
import BaseEvent from './BaseEvent';
import defaults from './defaultOptions';
export var EventPhase;
(function (EventPhase) {
    EventPhase["Start"] = "start";
    EventPhase["Move"] = "move";
    EventPhase["End"] = "end";
    EventPhase["_NONE"] = "";
})(EventPhase || (EventPhase = {}));
export class InteractEvent extends BaseEvent {
    /** */
    constructor(interaction, event, actionName, phase, element, related, preEnd, type) {
        super(interaction);
        element = element || interaction.element;
        const target = interaction.interactable;
        const deltaSource = ((target && target.options) || defaults).deltaSource;
        const origin = getOriginXY(target, element, actionName);
        const starting = phase === 'start';
        const ending = phase === 'end';
        const prevEvent = starting ? this : interaction.prevEvent;
        const coords = starting
            ? interaction.coords.start
            : ending
                ? { page: prevEvent.page, client: prevEvent.client, timeStamp: interaction.coords.cur.timeStamp }
                : interaction.coords.cur;
        this.page = extend({}, coords.page);
        this.client = extend({}, coords.client);
        this.rect = extend({}, interaction.rect);
        this.timeStamp = coords.timeStamp;
        if (!ending) {
            this.page.x -= origin.x;
            this.page.y -= origin.y;
            this.client.x -= origin.x;
            this.client.y -= origin.y;
        }
        this.ctrlKey = event.ctrlKey;
        this.altKey = event.altKey;
        this.shiftKey = event.shiftKey;
        this.metaKey = event.metaKey;
        this.button = event.button;
        this.buttons = event.buttons;
        this.target = element;
        this.currentTarget = element;
        this.relatedTarget = related || null;
        this.preEnd = preEnd;
        this.type = type || (actionName + (phase || ''));
        this.interactable = target;
        this.t0 = starting
            ? interaction.pointers[interaction.pointers.length - 1].downTime
            : prevEvent.t0;
        this.x0 = interaction.coords.start.page.x - origin.x;
        this.y0 = interaction.coords.start.page.y - origin.y;
        this.clientX0 = interaction.coords.start.client.x - origin.x;
        this.clientY0 = interaction.coords.start.client.y - origin.y;
        if (starting || ending) {
            this.delta = { x: 0, y: 0 };
        }
        else {
            this.delta = {
                x: this[deltaSource].x - prevEvent[deltaSource].x,
                y: this[deltaSource].y - prevEvent[deltaSource].y,
            };
        }
        this.dt = interaction.coords.delta.timeStamp;
        this.duration = this.timeStamp - this.t0;
        // velocity and speed in pixels per second
        this.velocity = extend({}, interaction.coords.velocity[deltaSource]);
        this.speed = hypot(this.velocity.x, this.velocity.y);
        this.swipe = (ending || phase === 'inertiastart') ? this.getSwipe() : null;
    }
    get pageX() { return this.page.x; }
    set pageX(value) { this.page.x = value; }
    get pageY() { return this.page.y; }
    set pageY(value) { this.page.y = value; }
    get clientX() { return this.client.x; }
    set clientX(value) { this.client.x = value; }
    get clientY() { return this.client.y; }
    set clientY(value) { this.client.y = value; }
    get dx() { return this.delta.x; }
    set dx(value) { this.delta.x = value; }
    get dy() { return this.delta.y; }
    set dy(value) { this.delta.y = value; }
    get velocityX() { return this.velocity.x; }
    set velocityX(value) { this.velocity.x = value; }
    get velocityY() { return this.velocity.y; }
    set velocityY(value) { this.velocity.y = value; }
    getSwipe() {
        const interaction = this._interaction;
        if (interaction.prevEvent.speed < 600 ||
            this.timeStamp - interaction.prevEvent.timeStamp > 150) {
            return null;
        }
        let angle = 180 * Math.atan2(interaction.prevEvent.velocityY, interaction.prevEvent.velocityX) / Math.PI;
        const overlap = 22.5;
        if (angle < 0) {
            angle += 360;
        }
        const left = 135 - overlap <= angle && angle < 225 + overlap;
        const up = 225 - overlap <= angle && angle < 315 + overlap;
        const right = !left && (315 - overlap <= angle || angle < 45 + overlap);
        const down = !up && 45 - overlap <= angle && angle < 135 + overlap;
        return {
            up,
            down,
            left,
            right,
            angle,
            speed: interaction.prevEvent.speed,
            velocity: {
                x: interaction.prevEvent.velocityX,
                y: interaction.prevEvent.velocityY,
            },
        };
    }
    preventDefault() { }
    /**
     * Don't call listeners on the remaining targets
     */
    stopImmediatePropagation() {
        this.immediatePropagationStopped = this.propagationStopped = true;
    }
    /**
     * Don't call any other listeners (even on the current target)
     */
    stopPropagation() {
        this.propagationStopped = true;
    }
}
export default InteractEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RFdmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkludGVyYWN0RXZlbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxNQUFNLE1BQU0sMEJBQTBCLENBQUE7QUFDN0MsT0FBTyxXQUFXLE1BQU0sK0JBQStCLENBQUE7QUFDdkQsT0FBTyxLQUFLLE1BQU0seUJBQXlCLENBQUE7QUFDM0MsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFBO0FBQ25DLE9BQU8sUUFBUSxNQUFNLGtCQUFrQixDQUFBO0FBSXZDLE1BQU0sQ0FBTixJQUFZLFVBS1g7QUFMRCxXQUFZLFVBQVU7SUFDcEIsNkJBQWUsQ0FBQTtJQUNmLDJCQUFhLENBQUE7SUFDYix5QkFBVyxDQUFBO0lBQ1gsd0JBQVUsQ0FBQTtBQUNaLENBQUMsRUFMVyxVQUFVLEtBQVYsVUFBVSxRQUtyQjtBQUVELE1BQU0sT0FBTyxhQUdYLFNBQVEsU0FBWTtJQWtDcEIsTUFBTTtJQUNOLFlBQ0UsV0FBd0IsRUFDeEIsS0FBZ0MsRUFDaEMsVUFBYSxFQUNiLEtBQVEsRUFDUixPQUFnQixFQUNoQixPQUFpQixFQUNqQixNQUFnQixFQUNoQixJQUFhO1FBRWIsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBRWxCLE9BQU8sR0FBRyxPQUFPLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQTtRQUV4QyxNQUFNLE1BQU0sR0FBUSxXQUFXLENBQUMsWUFBWSxDQUFBO1FBQzVDLE1BQU0sV0FBVyxHQUFJLENBQUMsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVEsQ0FBUyxDQUFDLFdBQWdDLENBQUE7UUFDdEcsTUFBTSxNQUFNLEdBQVEsV0FBVyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUE7UUFDNUQsTUFBTSxRQUFRLEdBQU0sS0FBSyxLQUFLLE9BQU8sQ0FBQTtRQUNyQyxNQUFNLE1BQU0sR0FBUSxLQUFLLEtBQUssS0FB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SSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUE7SUFDNUUsQ0FBQztJQUVELElBQUksS0FBSyxLQUFNLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ25DLElBQUksS0FBSyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBQ3pDLElBQUksS0FBSyxLQUFNLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ25DLElBQUksS0FBSyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBRXpDLElBQUksT0FBTyxLQUFNLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ3ZDLElBQUksT0FBTyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBQzdDLElBQUksT0FBTyxLQUFNLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ3ZDLElBQUksT0FBTyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBRTdDLElBQUksRUFBRSxLQUFNLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ2pDLElBQUksRUFBRSxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBQ3ZDLElBQUksRUFBRSxLQUFNLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ2pDLElBQUksRUFBRSxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBRXZDLElBQUksU0FBUyxLQUFNLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQzNDLElBQUksU0FBUyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBQ2pELElBQUksU0FBUyxLQUFNLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQzNDLElBQUksU0FBUyxDQUFFLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUEsQ0FBQyxDQUFDO0lBRWpELFFBQVE7UUFDTixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFBO1FBRXJDLElBQUksV0FBVyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsR0FBRztZQUNqQyxJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLEdBQUcsRUFBRTtZQUMxRCxPQUFPLElBQUksQ0FBQTtTQUNaO1FBRUQsSUFBSSxLQUFLLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ3hHLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQTtRQUVwQixJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDYixLQUFLLElBQUksR0FBRyxDQUFBO1NBQ2I7UUFFRCxNQUFNLElBQUksR0FBRyxHQUFHLEdBQUcsT0FBTyxJQUFJLEtBQUssSUFBSSxLQUFLLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQTtRQUM1RCxNQUFNLEVBQUUsR0FBSyxHQUFHLEdBQUcsT0FBTyxJQUFJLEtBQUssSUFBSSxLQUFLLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQTtRQUU1RCxNQUFNLEtBQUssR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLElBQUksS0FBSyxJQUFJLEtBQUssR0FBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUE7UUFDeEUsTUFBTSxJQUFJLEdBQUksQ0FBQyxFQUFFLElBQVEsRUFBRSxHQUFHLE9BQU8sSUFBSSxLQUFLLElBQUksS0FBSyxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUE7UUFFdkUsT0FBTztZQUNMLEVBQUU7WUFDRixJQUFJO1lBQ0osSUFBSTtZQUNKLEtBQUs7WUFDTCxLQUFLO1lBQ0wsS0FBSyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsS0FBSztZQUNsQyxRQUFRLEVBQUU7Z0JBQ1IsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsU0FBUztnQkFDbEMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxTQUFTLENBQUMsU0FBUzthQUNuQztTQUNGLENBQUE7SUFDSCxDQUFDO0lBRUQsY0FBYyxLQUFLLENBQUM7SUFFcEI7O09BRUc7SUFDSCx3QkFBd0I7UUFDdEIsSUFBSSxDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUE7SUFDbkUsQ0FBQztJQUVEOztPQUVHO0lBQ0gsZUFBZTtRQUNiLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUE7SUFDaEMsQ0FBQztDQUNGO0FBRUQsZUFBZSxhQUFhLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXh0ZW5kIGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzL2V4dGVuZCdcbmltcG9ydCBnZXRPcmlnaW5YWSBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy9nZXRPcmlnaW5YWSdcbmltcG9ydCBoeXBvdCBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy9oeXBvdCdcbmltcG9ydCBCYXNlRXZlbnQgZnJvbSAnLi9CYXNlRXZlbnQnXG5pbXBvcnQgZGVmYXVsdHMgZnJvbSAnLi9kZWZhdWx0T3B0aW9ucydcbmltcG9ydCBJbnRlcmFjdGlvbiBmcm9tICcuL0ludGVyYWN0aW9uJ1xuaW1wb3J0IHsgQWN0aW9uTmFtZSB9IGZyb20gJy4vc2NvcGUnXG5cbmV4cG9ydCBlbnVtIEV2ZW50UGhhc2Uge1xuICBTdGFydCA9ICdzdGFydCcsXG4gIE1vdmUgPSAnbW92ZScsXG4gIEVuZCA9ICdlbmQnLFxuICBfTk9ORSA9ICcnLFxufVxuXG5leHBvcnQgY2xhc3MgSW50ZXJhY3RFdmVudDxcbiAgVCBleHRlbmRzIEFjdGlvbk5hbWUgPSBhbnksXG4gIFAgZXh0ZW5kcyBFdmVudFBoYXNlID0gRXZlbnRQaGFzZS5fTk9ORSxcbj4gZXh0ZW5kcyBCYXNlRXZlbnQ8VD4ge1xuICB0YXJnZXQ6IEVsZW1lbnRcbiAgY3VycmVudFRhcmdldDogRWxlbWVudFxuICByZWxhdGVkVGFyZ2V0OiBFbGVtZW50XG4gIHNjcmVlblg/OiBudW1iZXJcbiAgc2NyZWVuWT86IG51bWJlclxuICBidXR0b246IG51bWJlclxuICBidXR0b25zOiBudW1iZXJcbiAgY3RybEtleTogYm9vbGVhblxuICBzaGlmdEtleTogYm9vbGVhblxuICBhbHRLZXk6IGJvb2xlYW5cbiAgbWV0YUtleTogYm9vbGVhblxuICBwYWdlOiBJbnRlcmFjdC5Qb2ludFxuICBjbGllbnQ6IEludGVyYWN0LlBvaW50XG4gIGRlbHRhOiBJbnRlcmFjdC5Qb2ludFxuICByZWN0OiBJbnRlcmFjdC5GdWxsUmVjdFxuICB4MDogbnVtYmVyXG4gIHkwOiBudW1iZXJcbiAgdDA6IG51bWJlclxuICBkdDogbnVtYmVyXG4gIGR1cmF0aW9uOiBudW1iZXJcbiAgY2xpZW50WDA6IG51bWJlclxuICBjbGllbnRZMDogbnVtYmVyXG4gIHZlbG9jaXR5OiBJbnRlcmFjdC5Qb2ludFxuICBzcGVlZDogbnVtYmVyXG4gIHN3aXBlOiBSZXR1cm5UeXBlPEludGVyYWN0RXZlbnQ8VD5bJ2dldFN3aXBlJ10+XG4gIHRpbWVTdGFtcDogYW55XG4gIC8vIGRyYWdcbiAgZHJhZ0VudGVyPzogRWxlbWVudFxuICBkcmFnTGVhdmU/OiBFbGVtZW50XG4gIC8vIHJlc2l6ZVxuICBheGVzPzogSW50ZXJhY3QuUG9pbnRcbiAgcHJlRW5kPzogYm9vbGVhblxuXG4gIC8qKiAqL1xuICBjb25zdHJ1Y3RvciAoXG4gICAgaW50ZXJhY3Rpb246IEludGVyYWN0aW9uLFxuICAgIGV2ZW50OiBJbnRlcmFjdC5Qb2ludGVyRXZlbnRUeXBlLFxuICAgIGFjdGlvbk5hbWU6IFQsXG4gICAgcGhhc2U6IFAsXG4gICAgZWxlbWVudDogRWxlbWVudCxcbiAgICByZWxhdGVkPzogRWxlbWVudCxcbiAgICBwcmVFbmQ/OiBib29sZWFuLFxuICAgIHR5cGU/OiBzdHJpbmcsXG4gICkge1xuICAgIHN1cGVyKGludGVyYWN0aW9uKVxuXG4gICAgZWxlbWVudCA9IGVsZW1lbnQgfHwgaW50ZXJhY3Rpb24uZWxlbWVudFxuXG4gICAgY29uc3QgdGFyZ2V0ICAgICAgPSBpbnRlcmFjdGlvbi5pbnRlcmFjdGFibGVcbiAgICBjb25zdCBkZWx0YVNvdXJjZSA9ICgoKHRhcmdldCAmJiB0YXJnZXQub3B0aW9ucykgfHwgZGVmYXVsdHMpIGFzIGFueSkuZGVsdGFTb3VyY2UgYXMgJ3BhZ2UnIHwgJ2NsaWVudCdcbiAgICBjb25zdCBvcmlnaW4gICAgICA9IGdldE9yaWdpblhZKHRhcmdldCwgZWxlbWVudCwgYWN0aW9uTmFtZSlcbiAgICBjb25zdCBzdGFydGluZyAgICA9IHBoYXNlID09PSAnc3RhcnQnXG4gICAgY29uc3QgZW5kaW5nICAgICAgPSBwaGFzZSA9PT0gJ2VuZCdcbiAgICBjb25zdCBwcmV2RXZlbnQgICA9IHN0YXJ0aW5nID8gdGhpcyA6IGludGVyYWN0aW9uLnByZXZFdmVudFxuICAgIGNvbnN0IGNvb3JkcyAgICAgID0gc3RhcnRpbmdcbiAgICAgID8gaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0XG4gICAgICA6IGVuZGluZ1xuICAgICAgICA/IHsgcGFnZTogcHJldkV2ZW50LnBhZ2UsIGNsaWVudDogcHJldkV2ZW50LmNsaWVudCwgdGltZVN0YW1wOiBpbnRlcmFjdGlvbi5jb29yZHMuY3VyLnRpbWVTdGFtcCB9XG4gICAgICAgIDogaW50ZXJhY3Rpb24uY29vcmRzLmN1clxuXG4gICAgdGhpcy5wYWdlICAgICAgPSBleHRlbmQoe30sIGNvb3Jkcy5wYWdlKVxuICAgIHRoaXMuY2xpZW50ICAgID0gZXh0ZW5kKHt9LCBjb29yZHMuY2xpZW50KVxuICAgIHRoaXMucmVjdCAgICAgID0gZXh0ZW5kKHt9LCBpbnRlcmFjdGlvbi5yZWN0KVxuICAgIHRoaXMudGltZVN0YW1wID0gY29vcmRzLnRpbWVTdGFtcFxuXG4gICAgaWYgKCFlbmRpbmcpIHtcbiAgICAgIHRoaXMucGFnZS54IC09IG9yaWdpbi54XG4gICAgICB0aGlzLnBhZ2UueSAtPSBvcmlnaW4ueVxuXG4gICAgICB0aGlzLmNsaWVudC54IC09IG9yaWdpbi54XG4gICAgICB0aGlzLmNsaWVudC55IC09IG9yaWdpbi55XG4gICAgfVxuXG4gICAgdGhpcy5jdHJsS2V5ICAgICAgID0gZXZlbnQuY3RybEtleVxuICAgIHRoaXMuYWx0S2V5ICAgICAgICA9IGV2ZW50LmFsdEtleVxuICAgIHRoaXMuc2hpZnRLZXkgICAgICA9IGV2ZW50LnNoaWZ0S2V5XG4gICAgdGhpcy5tZXRhS2V5ICAgICAgID0gZXZlbnQubWV0YUtleVxuICAgIHRoaXMuYnV0dG9uICAgICAgICA9IChldmVudCBhcyBNb3VzZUV2ZW50KS5idXR0b25cbiAgICB0aGlzLmJ1dHRvbnMgICAgICAgPSAoZXZlbnQgYXMgTW91c2VFdmVudCkuYnV0dG9uc1xuICAgIHRoaXMudGFyZ2V0ICAgICAgICA9IGVsZW1lbnRcbiAgICB0aGlzLmN1cnJlbnRUYXJnZXQgPSBlbGVtZW50XG4gICAgdGhpcy5yZWxhdGVkVGFyZ2V0ID0gcmVsYXRlZCB8fCBudWxsXG4gICAgdGhpcy5wcmVFbmQgICAgICAgID0gcHJlRW5kXG4gICAgdGhpcy50eXBlICAgICAgICAgID0gdHlwZSB8fCAoYWN0aW9uTmFtZSArIChwaGFzZSB8fCAnJykpXG4gICAgdGhpcy5pbnRlcmFjdGFibGUgID0gdGFyZ2V0XG5cbiAgICB0aGlzLnQwID0gc3RhcnRpbmdcbiAgICAgID8gaW50ZXJhY3Rpb24ucG9pbnRlcnNbaW50ZXJhY3Rpb24ucG9pbnRlcnMubGVuZ3RoIC0gMV0uZG93blRpbWVcbiAgICAgIDogcHJldkV2ZW50LnQwXG5cbiAgICB0aGlzLngwICAgICAgID0gaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0LnBhZ2UueCAtIG9yaWdpbi54XG4gICAgdGhpcy55MCAgICAgICA9IGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydC5wYWdlLnkgLSBvcmlnaW4ueVxuICAgIHRoaXMuY2xpZW50WDAgPSBpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQuY2xpZW50LnggLSBvcmlnaW4ueFxuICAgIHRoaXMuY2xpZW50WTAgPSBpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQuY2xpZW50LnkgLSBvcmlnaW4ueVxuXG4gICAgaWYgKHN0YXJ0aW5nIHx8IGVuZGluZykge1xuICAgICAgdGhpcy5kZWx0YSA9IHsgeDogMCwgeTogMCB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5kZWx0YSA9IHtcbiAgICAgICAgeDogdGhpc1tkZWx0YVNvdXJjZV0ueCAtIHByZXZFdmVudFtkZWx0YVNvdXJjZV0ueCxcbiAgICAgICAgeTogdGhpc1tkZWx0YVNvdXJjZV0ueSAtIHByZXZFdmVudFtkZWx0YVNvdXJjZV0ueSxcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmR0ICAgICAgICA9IGludGVyYWN0aW9uLmNvb3Jkcy5kZWx0YS50aW1lU3RhbXBcbiAgICB0aGlzLmR1cmF0aW9uICA9IHRoaXMudGltZVN0YW1wIC0gdGhpcy50MFxuXG4gICAgLy8gdmVsb2NpdHkgYW5kIHNwZWVkIGluIHBpeGVscyBwZXIgc2Vjb25kXG4gICAgdGhpcy52ZWxvY2l0eSA9IGV4dGVuZCh7fSwgaW50ZXJhY3Rpb24uY29vcmRzLnZlbG9jaXR5W2RlbHRhU291cmNlXSlcbiAgICB0aGlzLnNwZWVkID0gaHlwb3QodGhpcy52ZWxvY2l0eS54LCB0aGlzLnZlbG9jaXR5LnkpXG5cbiAgICB0aGlzLnN3aXBlID0gKGVuZGluZyB8fCBwaGFzZSA9PT0gJ2luZXJ0aWFzdGFydCcpID8gdGhpcy5nZXRTd2lwZSgpIDogbnVsbFxuICB9XG5cbiAgZ2V0IHBhZ2VYICgpIHsgcmV0dXJuIHRoaXMucGFnZS54IH1cbiAgc2V0IHBhZ2VYICh2YWx1ZSkgeyB0aGlzLnBhZ2UueCA9IHZhbHVlIH1cbiAgZ2V0IHBhZ2VZICgpIHsgcmV0dXJuIHRoaXMucGFnZS55IH1cbiAgc2V0IHBhZ2VZICh2YWx1ZSkgeyB0aGlzLnBhZ2UueSA9IHZhbHVlIH1cblxuICBnZXQgY2xpZW50WCAoKSB7IHJldHVybiB0aGlzLmNsaWVudC54IH1cbiAgc2V0IGNsaWVudFggKHZhbHVlKSB7IHRoaXMuY2xpZW50LnggPSB2YWx1ZSB9XG4gIGdldCBjbGllbnRZICgpIHsgcmV0dXJuIHRoaXMuY2xpZW50LnkgfVxuICBzZXQgY2xpZW50WSAodmFsdWUpIHsgdGhpcy5jbGllbnQueSA9IHZhbHVlIH1cblxuICBnZXQgZHggKCkgeyByZXR1cm4gdGhpcy5kZWx0YS54IH1cbiAgc2V0IGR4ICh2YWx1ZSkgeyB0aGlzLmRlbHRhLnggPSB2YWx1ZSB9XG4gIGdldCBkeSAoKSB7IHJldHVybiB0aGlzLmRlbHRhLnkgfVxuICBzZXQgZHkgKHZhbHVlKSB7IHRoaXMuZGVsdGEueSA9IHZhbHVlIH1cblxuICBnZXQgdmVsb2NpdHlYICgpIHsgcmV0dXJuIHRoaXMudmVsb2NpdHkueCB9XG4gIHNldCB2ZWxvY2l0eVggKHZhbHVlKSB7IHRoaXMudmVsb2NpdHkueCA9IHZhbHVlIH1cbiAgZ2V0IHZlbG9jaXR5WSAoKSB7IHJldHVybiB0aGlzLnZlbG9jaXR5LnkgfVxuICBzZXQgdmVsb2NpdHlZICh2YWx1ZSkgeyB0aGlzLnZlbG9jaXR5LnkgPSB2YWx1ZSB9XG5cbiAgZ2V0U3dpcGUgKCkge1xuICAgIGNvbnN0IGludGVyYWN0aW9uID0gdGhpcy5faW50ZXJhY3Rpb25cblxuICAgIGlmIChpbnRlcmFjdGlvbi5wcmV2RXZlbnQuc3BlZWQgPCA2MDAgfHxcbiAgICAgICAgdGhpcy50aW1lU3RhbXAgLSBpbnRlcmFjdGlvbi5wcmV2RXZlbnQudGltZVN0YW1wID4gMTUwKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGxldCBhbmdsZSA9IDE4MCAqIE1hdGguYXRhbjIoaW50ZXJhY3Rpb24ucHJldkV2ZW50LnZlbG9jaXR5WSwgaW50ZXJhY3Rpb24ucHJldkV2ZW50LnZlbG9jaXR5WCkgLyBNYXRoLlBJXG4gICAgY29uc3Qgb3ZlcmxhcCA9IDIyLjVcblxuICAgIGlmIChhbmdsZSA8IDApIHtcbiAgICAgIGFuZ2xlICs9IDM2MFxuICAgIH1cblxuICAgIGNvbnN0IGxlZnQgPSAxMzUgLSBvdmVybGFwIDw9IGFuZ2xlICYmIGFuZ2xlIDwgMjI1ICsgb3ZlcmxhcFxuICAgIGNvbnN0IHVwICAgPSAyMjUgLSBvdmVybGFwIDw9IGFuZ2xlICYmIGFuZ2xlIDwgMzE1ICsgb3ZlcmxhcFxuXG4gICAgY29uc3QgcmlnaHQgPSAhbGVmdCAmJiAoMzE1IC0gb3ZlcmxhcCA8PSBhbmdsZSB8fCBhbmdsZSA8ICA0NSArIG92ZXJsYXApXG4gICAgY29uc3QgZG93biAgPSAhdXAgICAmJiAgIDQ1IC0gb3ZlcmxhcCA8PSBhbmdsZSAmJiBhbmdsZSA8IDEzNSArIG92ZXJsYXBcblxuICAgIHJldHVybiB7XG4gICAgICB1cCxcbiAgICAgIGRvd24sXG4gICAgICBsZWZ0LFxuICAgICAgcmlnaHQsXG4gICAgICBhbmdsZSxcbiAgICAgIHNwZWVkOiBpbnRlcmFjdGlvbi5wcmV2RXZlbnQuc3BlZWQsXG4gICAgICB2ZWxvY2l0eToge1xuICAgICAgICB4OiBpbnRlcmFjdGlvbi5wcmV2RXZlbnQudmVsb2NpdHlYLFxuICAgICAgICB5OiBpbnRlcmFjdGlvbi5wcmV2RXZlbnQudmVsb2NpdHlZLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICBwcmV2ZW50RGVmYXVsdCAoKSB7fVxuXG4gIC8qKlxuICAgKiBEb24ndCBjYWxsIGxpc3RlbmVycyBvbiB0aGUgcmVtYWluaW5nIHRhcmdldHNcbiAgICovXG4gIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiAoKSB7XG4gICAgdGhpcy5pbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSB0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWVcbiAgfVxuXG4gIC8qKlxuICAgKiBEb24ndCBjYWxsIGFueSBvdGhlciBsaXN0ZW5lcnMgKGV2ZW4gb24gdGhlIGN1cnJlbnQgdGFyZ2V0KVxuICAgKi9cbiAgc3RvcFByb3BhZ2F0aW9uICgpIHtcbiAgICB0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWVcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBJbnRlcmFjdEV2ZW50XG4iXX0=